#include "assert.h"
#include "unistd.h"


#define PAGESIZE 4096
#define PAGES_IN_ARRAY 1280 
#define ELEMENTS_IN_ARRAY (PAGES_IN_ARRAY * PAGESIZE)/8

size_t big_array1[ELEMENTS_IN_ARRAY];  //5 Megabyes


//Test: exec with many arguments
int exec3_1()
{
    const char * path = "usr/exec_testprogram.sweb";
    char *argv[] = { 
    "3","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1",
    "1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1",
    "1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1",
    "1","1","1","1","1","1","1","1","1","1",
    "1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1",
    "1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1",
    "1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1",
    "1","1","1","1","1","1","1","1","1","2",
    "1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1",
    "1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1",
    "1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1",
    "1","1","1","1","1","1","1","1","1","1",
    "1","1", (char *)0 };

    execv(path, argv);
    assert(0);
    
    return 0;
}



int exec3()
{

  for(int i = 0; i < PAGES_IN_ARRAY; i++)
  {
    big_array1[i * (PAGESIZE / 8)] = (size_t)i;
  }

  for(int i = 0; i < PAGES_IN_ARRAY; i++)
  {
    assert(big_array1[i * (PAGESIZE / 8)] == i);
  }


  pid_t pid = fork();

  if (pid == -1)
  {
    return -1;
  } 
  else if (pid == 0) //Child
  {
    exec3_1();
    assert(0);    //this should never be reached

    return pid;
  } 
  else //parent
  {
    return 0;
  }
}
